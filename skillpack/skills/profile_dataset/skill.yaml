skill:
  name: "profile-dataset"
  version: "0.1.0"
  description: "Profile CSV datasets with comprehensive statistics and data quality insights"
  tags: ["data", "csv", "profiling", "analysis", "statistics"]

command:
  template: "skillpack profile-dataset --csv {csv_path}"
  binary: "skillpack"
  subcommand: "profile-dataset"
  arguments:
    csv_path:
      type: "file_path"
      required: true
      cli_name: "--csv"
      description: "Path to the CSV file to profile"
      validation:
        file_must_exist: true
        extensions: [".csv"]
        max_size_mb: 100

output:
  base_directory: "./out/profile_dataset/"
  files:
    - path: "profile.md"
      type: "markdown"
      description: "Human-readable profile report"
      content:
        - "File overview (path, size, rows, columns)"
        - "Per-column statistics"
    - path: "profile.json"
      type: "json"
      description: "Machine-readable profile data"
      schema:
        file_path: "string"
        file_size_bytes: "integer"
        row_count: "integer"
        column_count: "integer"
        profiled_at: "iso8601_datetime"
        columns:
          type: "array"
          items:
            name: "string"
            dtype: "string (integer|float|string|boolean)"
            total_count: "integer"
            null_count: "integer"
            null_rate: "float (0.0-1.0)"
            unique_count: "integer"
            sample_values: "array of strings"
            min_value: "number (nullable)"
            max_value: "number (nullable)"
            mean_value: "number (nullable)"
            median_value: "number (nullable)"
            std_dev: "number (nullable)"
            min_length: "integer (nullable, for strings)"
            max_length: "integer (nullable, for strings)"
            avg_length: "float (nullable, for strings)"

guardrails:
  allowed:
    - "Read the specified CSV file"
    - "Parse CSV content with headers"
    - "Calculate statistics (count, mean, min, max, etc.)"
    - "Write to ./out/profile_dataset/"
  forbidden:
    - "Modify the input CSV file"
    - "Delete any files"
    - "Execute arbitrary code"
    - "Access files other than the specified CSV"
    - "Make network requests"
    - "Load CSV into memory if larger than 100MB"

preconditions:
  - description: "CSV file exists and is readable"
    check: "File at csv_path exists with read permissions"
  - description: "CSV file has headers"
    check: "First row contains column headers"
  - description: "File is valid CSV format"
    check: "File can be parsed as comma-separated values"

postconditions:
  - description: "Profile files are created"
    check: "profile.md and profile.json exist in output directory"
  - description: "All columns are profiled"
    check: "profile.json contains entry for each column"
  - description: "Input file is unchanged"
    check: "Original CSV file is not modified"

errors:
  file_not_found:
    condition: "CSV file does not exist"
    message: "CSV file not found: {csv_path}"
    recovery: "Check the file path and ensure the CSV exists"
  no_headers:
    condition: "CSV file has no header row"
    message: "CSV file has no headers"
    recovery: "Ensure the CSV has a header row"
  encoding_error:
    condition: "File encoding is not UTF-8"
    message: "Unable to read file with UTF-8 encoding"
    recovery: "Convert file to UTF-8 encoding"
  empty_file:
    condition: "CSV file has no data rows"
    message: "CSV file is empty (no data rows)"
    recovery: "Provide a CSV with at least one data row"

statistics_computed:
  all_columns:
    - "total_count: Total number of rows"
    - "null_count: Count of null/empty values"
    - "unique_count: Count of distinct values"
    - "sample_values: Up to 5 unique sample values"
  numeric_columns:
    - "min_value: Minimum value"
    - "max_value: Maximum value"
    - "mean_value: Arithmetic mean"
    - "median_value: Median (50th percentile)"
    - "std_dev: Standard deviation"
  string_columns:
    - "min_length: Shortest string length"
    - "max_length: Longest string length"
    - "avg_length: Average string length"

examples:
  - name: "Profile users CSV"
    description: "Profile a simple users table"
    input:
      csv_path: "data/users.csv"
    command: "skillpack profile-dataset --csv data/users.csv"
    expected_output:
      files_created:
        - "./out/profile_dataset/profile.md"
        - "./out/profile_dataset/profile.json"
      
  - name: "Profile with absolute path"
    description: "Profile using absolute file path"
    input:
      csv_path: "/home/user/data/sales.csv"
    command: "skillpack profile-dataset --csv /home/user/data/sales.csv"
    expected_output:
      files_created:
        - "./out/profile_dataset/profile.md"
        - "./out/profile_dataset/profile.json"

related_skills:
  - name: "data-quality"
    reason: "Generate validation schema based on profile"
  - name: "schema-diff"
    reason: "Compare schema changes over time"
