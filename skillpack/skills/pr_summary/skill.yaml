skill:
  name: "pr-summary"
  version: "0.1.0"
  description: "Generate comprehensive PR summaries with risk assessment from git diffs"
  tags: ["pr", "git", "review", "risk", "documentation"]

command:
  template: "skillpack pr-summary --diff-file {diff_file} --title {title}"
  binary: "skillpack"
  subcommand: "pr-summary"
  arguments:
    diff_file:
      type: "file_path"
      required: true
      cli_name: "--diff-file"
      description: "Path to the unified diff file to analyze"
      validation:
        file_must_exist: true
        extensions: [".diff", ".patch", ".txt", ""]
    title:
      type: "string"
      required: false
      cli_name: "--title"
      default: "Pull Request Summary"
      description: "Title for the PR summary"
      validation:
        max_length: 200

output:
  base_directory: "./out/pr_summary/"
  files:
    - path: "PR_SUMMARY.md"
      type: "markdown"
      description: "Comprehensive PR summary with risk assessment"
      sections:
        - "Overview (files changed, lines added/removed)"
        - "Risk Assessment (LOW/MEDIUM/HIGH)"
        - "Risk Factors"
        - "File Types Changed"
        - "Files Changed list"
        - "Rollout Plan"
        - "Rollback Plan"
        - "Testing Checklist"

guardrails:
  allowed:
    - "Read the specified diff file"
    - "Parse unified diff format"
    - "Write to ./out/pr_summary/"
    - "Calculate statistics from diff content"
  forbidden:
    - "Execute git commands"
    - "Modify any repository files"
    - "Delete any files"
    - "Access files other than the specified diff"
    - "Make network requests"
    - "Access git history or refs"

preconditions:
  - description: "Diff file exists and is readable"
    check: "File at diff_file path exists and has read permissions"
  - description: "Diff file is in unified diff format"
    check: "File contains valid unified diff content"

postconditions:
  - description: "PR summary file is created"
    check: "./out/pr_summary/PR_SUMMARY.md exists"
  - description: "Summary contains all required sections"
    check: "PR_SUMMARY.md has Overview, Risk Assessment, Files Changed sections"
  - description: "Input file is unchanged"
    check: "Original diff file is not modified"

errors:
  file_not_found:
    condition: "Diff file does not exist"
    message: "Diff file not found: {diff_file}"
    recovery: "Check the file path and ensure the diff file exists"
  invalid_diff:
    condition: "File is not a valid unified diff"
    message: "Invalid diff format in: {diff_file}"
    recovery: "Ensure file is a unified diff (e.g., from 'git diff')"
  empty_diff:
    condition: "Diff file is empty"
    message: "Diff file is empty: {diff_file}"
    recovery: "Provide a diff file with actual changes"

risk_assessment:
  factors:
    - name: "large_change"
      condition: "total_lines > 500"
      risk_increase: 2
      description: "Large changes are harder to review"
    - name: "many_files"
      condition: "files_changed > 20"
      risk_increase: 2
      description: "Many files affected increases risk"
    - name: "database_changes"
      condition: "files contain .sql or migration"
      risk_increase: 1
      description: "Database changes require extra care"
    - name: "config_changes"
      condition: "files contain .yml, .yaml, .env"
      risk_increase: 1
      description: "Configuration changes may affect deployment"
  levels:
    LOW: "risk_score < 2"
    MEDIUM: "risk_score >= 2 and risk_score < 4"
    HIGH: "risk_score >= 4"

examples:
  - name: "Summarize feature branch diff"
    description: "Generate summary from a git diff file"
    input:
      diff_file: "changes.diff"
    command: "skillpack pr-summary --diff-file changes.diff"
    expected_output:
      files_created: ["./out/pr_summary/PR_SUMMARY.md"]
      
  - name: "Summarize with custom title"
    description: "Generate summary with feature name as title"
    input:
      diff_file: "/tmp/feature.diff"
      title: "Feature: User Authentication"
    command: "skillpack pr-summary --diff-file /tmp/feature.diff --title \"Feature: User Authentication\""
    expected_output:
      files_created: ["./out/pr_summary/PR_SUMMARY.md"]

workflow:
  pre_steps:
    - description: "Generate diff from git"
      command: "git diff main..HEAD > changes.diff"
      note: "This step is manual, not executed by the skill"
  post_steps:
    - description: "Review generated summary"
      command: "cat ./out/pr_summary/PR_SUMMARY.md"
    - description: "Include in PR description"
      note: "Copy content to PR description or attach as comment"

related_skills:
  - name: "quality-gate"
    reason: "Run quality checks before creating PR"
  - name: "schema-diff"
    reason: "Analyze database schema changes in the PR"
